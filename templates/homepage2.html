<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href={{ url_for('static', path='styles/sheet_homepage2.css') }}>
    <title>Accueil ‚Ä¢ I-Leaf</title>
  <link rel = "icon" type = "image/x-icon" href ={{ url_for('static', path='images/logo_i_leaf_without_name.svg') }}>
</head>
<body>
    <div class="text-area">
        <div>
            <img id="logo" src={{ url_for('static', path='images/logo_i_leaf_with_name_cropped.png') }}>
        </div>
        <div>
            <h1 style ="font-size: 2em;">Bienvenue sur le site de I-Leaf !</h1>
            <br>
            <h2 style="font-size: 30px; justify-content: end"><b>I-Leaf</b> vous propose une solution de gestion de logement √©co-responsable, permettant de suivre en temps r√©el
            les <b>pr√©visions m√©t√©o sp√©cifiques √† votre b√¢timent</b> pour optimiser sa consommation √©nerg√©tique.<br><br>
            G√©rez vos <b>factures</b>, estimez les <b>√©conomies r√©alis√©es</b> et acc√©dez √† un tableau de bord complet affichant 
            l'√©tat des capteurs int√©gr√©s dans votre logement (luminosit√©, pr√©sence, humidit√©, temp√©rature). <br>
            En combinant donn√©es en temps r√©el et outils de gestion, I-Leaf favorise une prise de d√©cision √©clair√©e
            et contribue √† r√©duire l'empreinte √©cologique des habitations.
            </h2>
        </div>
    </div>
    <div class="circle-container">
        <div class="circle" id="housing">
            <span class="icon">üè†</span>
            <div class="text">Logements</div>
        </div>
        <div class="circle" id="weather">
            <span class="icon">‚õÖ</span>
            <div class="text">M√©t√©o</div>
        </div>
        <div class="circle" id="bill">
            <span class="icon">üìÑ</span>
            <div class="text">Factures</div>
        </div>
    </div>
    
    <script>
        // S√©lection des √©l√©ments du DOM
        const circles = document.querySelectorAll('.circle');
        const circleContainer = document.querySelector('.circle-container');
        const textArea = document.querySelector('.text-area');
        let clickedCircleCategory = '';

        // Fonction pour r√©initialiser la disposition
        function resetPageState() {
            // R√©afficher tous les cercles
            circles.forEach(circle => {
                circle.style.display = 'flex'; // Remet les cercles visibles
                circle.style.transform = '';
                circle.style.background = '';
            });
            // Supprimer le menu d√©roulant et le bouton s'ils existent
            const existingDropdown = document.getElementById('dropdown-menu');
            const existingButton = document.getElementById('submit-button');
            if (existingDropdown) existingDropdown.remove();
            if (existingButton) existingButton.remove();
            clickedCircleCategory = '';
        }
        // Ajouter un √©v√©nement global sur le document pour d√©tecter les clics en dehors
        document.addEventListener('click', function (event) {
            const isClickInsideCircle = event.target.closest('.circle'); // V√©rifie si le clic est sur un cercle
            const isClickInsideMenu = event.target.closest('#dropdown-menu'); // V√©rifie si le clic est sur le menu
            const isClickInsideButton = event.target.closest('#submit-button'); // V√©rifie si le clic est sur le bouton
            // Si le clic est en dehors des cercles, du menu, et du bouton
            if (!isClickInsideCircle && !isClickInsideMenu && !isClickInsideButton) {
                resetPageState(); // R√©initialiser la page
            }
        });

        // Fonction qui r√©initialise les cercles et le fond
        function resetCirclesAndBackground() {
            textArea.style.transform = '';
            circles.forEach(circle => {
                circle.classList.remove('not-hovered');
                circle.style.backgroundColor = '#A3B87D'; // Couleur initiale des cercles
            });
            document.body.style.backgroundColor = ''; // R√©initialise le fond
        }
    
        // Fonction pour changer la couleur de fond
        function changeBackgroundColor(event) {
            resetCirclesAndBackground(); // R√©initialise avant modification
            const circle = event.currentTarget;
            let backgroundGradient = '';
            clickedCircleCategory = circle.id;
            if (circle.id === 'housing') {
                backgroundGradient = 'radial-gradient(circle, #FFD898, #FFEFD5)'; 
            } else if (circle.id === 'weather') {
                backgroundGradient = 'radial-gradient(circle, #86e1ff, #4ABFF7)';
            } else if (circle.id === 'bill') {
                backgroundGradient = 'radial-gradient(circle, #a6b3bc, #87959F)';
            }
            document.body.style.background = backgroundGradient;
            circle.style.background = backgroundGradient;
            circle.classList.add('hovered');
            circles.forEach(otherCircle => {
                if (otherCircle !== circle) {
                    otherCircle.classList.add('not-hovered');
                }
            });
        }
    
        // Ajout des √©v√©nements de survol
        circles.forEach(circle => {
            circle.addEventListener('mouseover', changeBackgroundColor);
            circle.addEventListener('mouseout', resetCirclesAndBackground);
        });
    
        // Cr√©er un menu d√©roulant et un bouton d‚Äôenvoi
        const dropdownMenu = document.createElement('select');
        dropdownMenu.id = 'dropdown-menu';
        dropdownMenu.innerHTML = `
            <option value="">‚Ä¢ Choisir un logement </option>
            {% for h in housing %}
                <option value="{{ h['id'] }}"> {{ h['nom'] }}</option>
            {% endfor %}
            `
            // <option value="option1">Option 1</option>
            // <option value="option2">Option 2</option>
            // <option value="option3">Option 3</option>
        ;
        const submitButton = document.createElement('button');
        submitButton.id = 'submit-button';
        submitButton.textContent = 'Envoyer';
        submitButton.disabled = true;
    
        // Fonction pour cacher les cercles sauf celui cliqu√©
        function hideOtherCircles(clickedCircle) {
            textArea.style.transform = 'transform(-50%, 0%)';
            circles.forEach(circle => {
                if (circle !== clickedCircle) {
                    circle.style.display = 'none';
                }
            });
        }
    
        // Activer ou d√©sactiver le bouton selon la s√©lection
        dropdownMenu.addEventListener('change', () => {
            submitButton.disabled = dropdownMenu.value === '';
        });
    
        // Ajouter un √©v√©nement de clic pour chaque cercle
        circles.forEach(circle => {
            circle.addEventListener('click', function () {
                // event.stopPropagation(); // Emp√™che la propagation pour √©viter que le clic soit capt√© par `document`
                hideOtherCircles(this); // Cacher les autres cercles
                circleContainer.appendChild(dropdownMenu);
                circleContainer.appendChild(submitButton);
                // Supprimer les instances pr√©c√©dentes de menu d√©roulant et bouton
                const existingDropdown = document.getElementById('dropdown-menu');
                const existingButton = document.getElementById('submit-button');
                if (existingDropdown) existingDropdown.remove();
                if (existingButton) existingButton.remove();
                // Ajouter le menu d√©roulant et le bouton au conteneur
                circleContainer.appendChild(dropdownMenu);
                circleContainer.appendChild(submitButton);
                // Translater le cercle cliqu√©, le menu d√©roulant et le bouton
                this.style.transform = 'translate(-25%, -125%)';
                dropdownMenu.style.transform = 'translate(100%, -850%)';
                submitButton.style.transform = 'translate(150%, -850%)';
            });
        });
    
        // Ajouter un √©v√©nement au bouton pour la redirection
        submitButton.addEventListener('click', () => {
            if (dropdownMenu.value !== '' && clickedCircleCategory !== '') {
                if (clickedCircleCategory === 'weather'){
                    window.location.href = `/meteo/${dropdownMenu.value}/`;
                }
                if (clickedCircleCategory === 'bill'){
                    window.location.href = `/factures/${dropdownMenu.value}/`;
                }
                if (clickedCircleCategory === 'housing'){
                    window.location.href = `/logement/${dropdownMenu.value}/`;
                }      
            }
        });
    </script>
    

</body>
</html>
